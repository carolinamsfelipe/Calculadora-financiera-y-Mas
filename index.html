<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora Financiera - Caro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      padding: 24px 16px 40px;
    }

    header {
      margin-bottom: 16px;
    }

    h1 {
      text-align: center;
      margin-bottom: 4px;
    }

    .subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: #9ca3af;
      margin-bottom: 8px;
    }

    .brand {
      text-align: center;
      font-size: 0.8rem;
      color: #a5b4fc;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-left: 6px;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .card {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 16px;
      padding: 16px 18px 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 6px;
      font-size: 1.05rem;
    }

    .card small {
      display: block;
      margin-bottom: 12px;
      color: #9ca3af;
    }

    label {
      display: block;
      margin-top: 8px;
      margin-bottom: 4px;
      font-size: 0.85rem;
      color: #d1d5db;
    }

    input, select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
      outline: none;
    }

    input:focus, select:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.4);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    button {
      margin-top: 12px;
      width: 100%;
      padding: 9px 10px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #38bdf8, #8b5cf6);
      color: white;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }

    button:hover {
      filter: brightness(1.05);
    }

    .result {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(15,23,42,0.9);
      border: 1px dashed rgba(148,163,184,0.6);
      font-size: 0.9rem;
      min-height: 44px;
    }

    .result strong {
      display: block;
      font-size: 1rem;
      margin-bottom: 2px;
      color: #facc15;
    }

    .footer-note {
      margin-top: 24px;
      text-align: center;
      font-size: 0.8rem;
      color: #9ca3af;
      line-height: 1.4;
    }

    .formula {
      display: block;
      margin-top: 4px;
    }

    /* Tabla amortizaci√≥n */
    .amort-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.8rem;
    }

    .amort-table th,
    .amort-table td {
      border-bottom: 1px solid #1f2937;
      padding: 4px 6px;
      text-align: right;
    }

    .amort-table th:first-child,
    .amort-table td:first-child {
      text-align: center;
    }

    .amort-table tfoot td {
      font-weight: 600;
      border-top: 1px solid #4b5563;
    }

    /* √çndice ocupa todo el ancho */
    .index-card {
      grid-column: 1 / -1;
    }

    .index-card ol {
      padding-left: 18px;
      margin: 0;
      font-size: 0.9rem;
    }

    .index-card li {
      margin-bottom: 6px;
    }

    /* Botones del √≠ndice desplegable */
    .index-item {
      background: none;
      border: none;
      color: #e5e7eb;
      padding: 2px 0;
      text-align: left;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
    }

    .index-item:hover {
      color: #38bdf8;
    }

    .index-detail {
      display: none;
      margin-top: 4px;
      margin-bottom: 8px;
      padding-left: 8px;
      font-size: 0.85rem;
      color: #d1d5db;
    }

    .index-detail span.estado {
      display: inline-block;
      margin-top: 4px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #4b5563;
    }

    .estado-ok {
      border-color: #22c55e;
      color: #22c55e;
    }

    .estado-pend {
      border-color: #f97316;
      color: #f97316;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Calculadora Financiera</h1>
      <div class="subtitle">
        Laboratorio de valor del dinero en el tiempo, tasas, cuotas y proyectos
        <span class="tag">beta</span>
      </div>
      <div class="brand">by Carolina Sinead Felipe</div>
    </header>

    <div class="cards">
      <!-- √çNDICE DE M√ìDULOS (DESPLEGABLE) -->
      <div class="card index-card">
        <h2>√çndice de m√≥dulos</h2>
        <small>Mapa de herramientas pensadas para distintos perfiles financieros. Hac√© click en cada t√≠tulo para ver los detalles.</small>

        <ol>
          <li>
            <strong> Para inversionistas y ahorristas comunes</strong>
            <ol>
              <li>
                <button class="index-item" data-target="idx-1">
                  Comparador de Plazo Fijo tradicional vs UVA
                </button>
                <div class="index-detail" id="idx-1">
                  Ingresar: monto, TNA, inflaci√≥n estimada, d√≠as.<br>
                  Resultado: Cu√°l conviene ‚Üí monto final real.<br>
                  Alt√≠sima demanda en Argentina!<br>
                  <span class="estado estado-ok">Funcionalidad disponible - m√≥dulo "Comparador PF vs UVA"</span>
                </div>
              </li>
              <li>
                <button class="index-item" data-target="idx-2">
                  Simulador de inter√©s compuesto con aportes variables
                </button>
                <div class="index-detail" id="idx-2">
                  Tu versi√≥n actual trabaja con aportes fijos por per√≠odo.<br>
                  Versi√≥n futura: permitir meses sin aportar, aportes distintos y retiradas parciales.<br>
                  <span class="estado estado-ok">Funcionalidad b√°sica disponible - "Simulador inversi√≥n con aportes"</span>
                </div>
              </li>
              <li>
                <button class="index-item" data-target="idx-3">
                  Plan de ahorro para objetivos
                </button>
                <div class="index-detail" id="idx-3">
                  Ejemplo: ‚ÄúQuiero juntar USD 10.000 en 3 a√±os‚Äù.<br>
                  La herramienta deber√≠a responder:<br>
                  ‚Ä¢ cu√°nto aportar por mes<br>
                  ‚Ä¢ a qu√© tasa m√≠nima<br>
                  ‚Ä¢ gr√°fico del progreso<br>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
              <li>
                <button class="index-item" data-target="idx-4">
                  Calculadora de tipo de cambio
                </button>
                <div class="index-detail" id="idx-4">
                  Tipos de cambio a considerar:<br>
                  ‚Ä¢ Oficial<br>
                  ‚Ä¢ MEP<br>
                  ‚Ä¢ CCL<br>
                  ‚Ä¢ Solidario<br>
                  ‚Ä¢ Tarjeta<br>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
            </ol>
          </li>

          <li style="margin-top:10px;">
            <strong>2 - Para analistas financieros / corporativos</strong>
            <ol start="5">
              <li>
                <button class="index-item" data-target="idx-5">
                  VAN y TIR (Flujos de caja)
                </button>
                <div class="index-detail" id="idx-5">
                  Ingresar una serie de flujos.<br>
                  Resultado esperado:<br>
                  ‚Ä¢ Valor Actual Neto (VAN)<br>
                  ‚Ä¢ Tasa Interna de Retorno (TIR)<br>
                  ‚Ä¢ ROI<br>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
              <li>
                <button class="index-item" data-target="idx-6">
                Duraci√≥n y Duration modificada (bonos)
                </button>
                <div class="index-detail" id="idx-6">
                  Para analizar sensibilidad a tasas de inter√©s en bonos.<br>
                  Datos: precio, cup√≥n, vencimiento, rendimiento, duraci√≥n y riesgo de tasa.<br>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
              <li>
                <button class="index-item" data-target="idx-7">
                  Curva de bonos simple
                </button>
                <div class="index-detail" id="idx-7">
                  Ingresan varios bonos y se grafica:<br>
                  ‚Ä¢ Duration<br>
                  ‚Ä¢ Yield<br>
                  ‚Ä¢ Precio<br>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
              <li>
                <button class="index-item" data-target="idx-8">
                 C√°lculo de paridad de bonos
                </button>
                <div class="index-detail" id="idx-8">
                  Ideal para Argentina.<br>
                  Datos: precio, valor t√©cnico, cup√≥n, TIR y paridad %.<br>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
            </ol>
          </li>
        </ol>
      </div>

      <!-- CARD COMPARADOR PF TRADICIONAL VS UVA -->
      <div class="card">
        <h2>Comparador PF tradicional vs UVA</h2>
        <small>Ingres√° tu escenario y compar√° cu√°l rinde m√°s, en t√©rminos nominales y reales.</small>

        <label for="pf-monto">Monto a invertir</label>
        <input id="pf-monto" type="number" placeholder="Ej: 100000" />

        <label for="pf-tna">TNA Plazo Fijo tradicional (%)</label>
        <input id="pf-tna" type="number" step="0.01" placeholder="Ej: 110" />

        <label for="pf-inflacion">Inflaci√≥n esperada anual (%)</label>
        <input id="pf-inflacion" type="number" step="0.01" placeholder="Ej: 180" />

        <label for="pf-plus">Plus real UVA sobre inflaci√≥n (opcional, % anual)</label>
        <input id="pf-plus" type="number" step="0.01" placeholder="Ej: 0 √≥ 5" />

        <label for="pf-dias">Plazo en d√≠as</label>
        <input id="pf-dias" type="number" placeholder="Ej: 30, 60, 90, 180" />

        <button id="btn-pf-uva">Comparar PF vs UVA</button>

        <div class="result" id="pf-uva-result">
          Ingres√° los datos y te muestro cu√°nto terminar√≠as con PF tradicional vs UVA, y qui√©n gana en t√©rminos reales.
        </div>
      </div>

      <!-- CARD CONVERSOR DE TASAS -->
      <div class="card">
        <h2>Conversor de tasas</h2>
        <small>TNA, TEA y TEM suponiendo capitalizaci√≥n mensual (12 per√≠odos al a√±o).</small>

        <label for="rate-type">Tipo de tasa conocida</label>
        <select id="rate-type">
          <option value="tna">TNA (nominal anual)</option>
          <option value="tea">TEA (efectiva anual)</option>
          <option value="tem">TEM (efectiva mensual)</option>
        </select>

        <label for="rate-input">Valor de la tasa (%)</label>
        <input id="rate-input" type="number" step="0.0001" placeholder="Ej: 97 (TNA) √≥ 8 (TEM)" />

        <button id="btn-rate-convert">Convertir</button>

        <div class="result" id="rate-result">
          Ingres√° una tasa y convert√≠ entre TNA, TEA y TEM (mensual).
        </div>
      </div>

      <!-- CARD SIMULADOR DE INVERSI√ìN -->
      <div class="card">
        <h2>Simulador inversi√≥n con aportes</h2>
        <small>Capital inicial + aporte fijo por per√≠odo, con inter√©s compuesto.</small>

        <label for="sim-pv">Capital inicial (opcional)</label>
        <input id="sim-pv" type="number" placeholder="Ej: 50000 (pod√©s dejar en blanco)" />

        <label for="sim-pmt">Aporte por per√≠odo</label>
        <input id="sim-pmt" type="number" placeholder="Ej: 20000" />

        <label for="sim-rate">Tasa por per√≠odo (%)</label>
        <input id="sim-rate" type="number" step="0.0001" placeholder="Ej: 5 (significa 5%)" />

        <div class="row">
          <div>
            <label for="sim-n">Cantidad de per√≠odos (n)</label>
            <input id="sim-n" type="number" placeholder="Ej: 12" />
          </div>
          <div>
            <label for="sim-period">Per√≠odo</label>
            <select id="sim-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-sim">Calcular inversi√≥n</button>

        <div class="result" id="sim-result">
          Ingres√° los datos para ver el valor futuro y cu√°nto aportaste en total.
        </div>
      </div>

      <!-- CARD FV -->
      <div class="card">
        <h2>Valor Futuro (FV)</h2>
        <small>¬øCu√°nto voy a tener al final si invierto hoy un monto a una tasa fija?</small>

        <label for="fv-pv">Monto inicial (PV)</label>
        <input id="fv-pv" type="number" placeholder="Ej: 100000" />

        <label for="fv-rate">Tasa por per√≠odo (%)</label>
        <input id="fv-rate" type="number" step="0.0001" placeholder="Ej: 5 (significa 5%)" />

        <div class="row">
          <div>
            <label for="fv-n">Cantidad de per√≠odos (n)</label>
            <input id="fv-n" type="number" placeholder="Ej: 12" />
          </div>
          <div>
            <label for="fv-period">Per√≠odo</label>
            <select id="fv-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-fv">Calcular FV</button>

        <div class="result" id="fv-result">
          Ingres√° los datos y calcul√° el valor futuro.
        </div>
      </div>

      <!-- CARD PV -->
      <div class="card">
        <h2>Valor Presente (PV)</h2>
        <small>¬øCu√°nto necesito hoy para alcanzar un monto futuro deseado?</small>

        <label for="pv-fv">Monto futuro (FV)</label>
        <input id="pv-fv" type="number" placeholder="Ej: 500000" />

        <label for="pv-rate">Tasa por per√≠odo (%)</label>
        <input id="pv-rate" type="number" step="0.0001" placeholder="Ej: 4 (significa 4%)" />

        <div class="row">
          <div>
            <label for="pv-n">Cantidad de per√≠odos (n)</label>
            <input id="pv-n" type="number" placeholder="Ej: 24" />
          </div>
          <div>
            <label for="pv-period">Per√≠odo</label>
            <select id="pv-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-pv">Calcular PV</button>

        <div class="result" id="pv-result">
          Ingres√° los datos y calcul√° el valor presente.
        </div>
      </div>

      <!-- CARD PMT -->
      <div class="card">
        <h2>Cuota (PMT)</h2>
        <small>Pr√©stamo o inversi√≥n con pagos iguales (sistema franc√©s cl√°sico).</small>

        <label for="pmt-pv">Monto del pr√©stamo / inversi√≥n (PV)</label>
        <input id="pmt-pv" type="number" placeholder="Ej: 300000" />

        <label for="pmt-rate">Tasa por per√≠odo (%)</label>
        <input id="pmt-rate" type="number" step="0.0001" placeholder="Ej: 6 (significa 6%)" />

        <div class="row">
          <div>
            <label for="pmt-n">Cantidad de per√≠odos (n)</label>
            <input id="pmt-n" type="number" placeholder="Ej: 36" />
          </div>
          <div>
            <label for="pmt-period">Per√≠odo</label>
            <select id="pmt-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-pmt">Calcular cuota</button>

        <div class="result" id="pmt-result">
          Ingres√° los datos y calcul√° la cuota peri√≥dica.
        </div>
      </div>

      <!-- CARD CR√âDITOS Y TABLA DE AMORTIZACI√ìN -->
      <div class="card">
        <h2>Cr√©ditos y tabla de amortizaci√≥n</h2>
        <small>Gener√° el cuadro de cuotas seg√∫n sistema Franc√©s, Alem√°n o Americano.</small>

        <label for="loan-amount">Monto del cr√©dito</label>
        <input id="loan-amount" type="number" placeholder="Ej: 500000" />

        <label for="loan-rate">Tasa por per√≠odo (%)</label>
        <input id="loan-rate" type="number" step="0.0001" placeholder="Ej: 5 (significa 5%)" />

        <div class="row">
          <div>
            <label for="loan-n">Cantidad de per√≠odos (n)</label>
            <input id="loan-n" type="number" placeholder="Ej: 24" />
          </div>
          <div>
            <label for="loan-system">Sistema</label>
            <select id="loan-system">
              <option value="frances">Franc√©s (cuota fija)</option>
              <option value="aleman">Alem√°n (amortizaci√≥n fija)</option>
              <option value="americano">Americano (intereses + bullet)</option>
            </select>
          </div>
        </div>

        <button id="btn-loan">Generar tabla</button>

        <div class="result" id="loan-result">
          Complet√° los datos y gener√° la tabla de amortizaci√≥n.
        </div>

        <div id="loan-table-wrapper"></div>
      </div>
    </div>

    <div class="footer-note">
      <span class="formula">FV = PV ¬∑ (1 + i)<sup>n</sup></span>
      <span class="formula">PV = FV / (1 + i)<sup>n</sup></span>
      <span class="formula">PMT = PV ¬∑ [ i / (1 - (1 + i)<sup>-n</sup> ) ]</span>
      <span class="formula">TEA = (1 + TEM)<sup>12</sup> ‚àí 1 &nbsp; | &nbsp; TNA ‚âà TEM ¬∑ 12</span>
    </div>
  </div>

  <script>
    function formatMoney(value) {
      if (isNaN(value)) return "-";
      return value.toLocaleString("es-AR", {
        style: "currency",
        currency: "ARS",
        maximumFractionDigits: 2
      });
    }

    function formatPercent(value) {
      if (isNaN(value)) return "-";
      return (value * 100).toFixed(2) + "%";
    }

    // ---- √çNDICE DESPLEGABLE ----
    document.querySelectorAll(".index-item").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.target;
        const panel = document.getElementById(id);
        if (!panel) return;
        const visible = panel.style.display === "block";
        panel.style.display = visible ? "none" : "block";
      });
    });

    // ---- COMPARADOR PF TRADICIONAL VS UVA ----
    document.getElementById("btn-pf-uva").addEventListener("click", function () {
      const monto = parseFloat(document.getElementById("pf-monto").value);
      const tnaPF = parseFloat(document.getElementById("pf-tna").value);
      const inflAnual = parseFloat(document.getElementById("pf-inflacion").value);
      const plusReal = parseFloat(document.getElementById("pf-plus").value || "0");
      const dias = parseFloat(document.getElementById("pf-dias").value);
      const resultDiv = document.getElementById("pf-uva-result");

      if (isNaN(monto) || isNaN(tnaPF) || isNaN(inflAnual) || isNaN(dias) || dias <= 0) {
        resultDiv.innerHTML = "üëÄ Complet√° monto, TNA, inflaci√≥n y d√≠as (el plus UVA puede quedar vac√≠o).";
        return;
      }

      const tnaPFDecimal = tnaPF / 100;
      const inflAnualDec = inflAnual / 100;
      const plusRealDec = plusReal / 100;

      // PF tradicional: inter√©s simple proporcional a los d√≠as
      const interesPF = tnaPFDecimal * (dias / 365);
      const montoPF = monto * (1 + interesPF);

      // Inflaci√≥n del per√≠odo (compuesta)
      const inflPeriodo = Math.pow(1 + inflAnualDec, dias / 365) - 1;

      // UVA: inflaci√≥n + plus real, compuesto
      const tasaUVAAnual = (1 + inflAnualDec) * (1 + plusRealDec) - 1;
      const tasaUVAPeriodo = Math.pow(1 + tasaUVAAnual, dias / 365) - 1;
      const montoUVA = monto * (1 + tasaUVAPeriodo);

      // Valores reales (descontando inflaci√≥n del per√≠odo)
      const factorInfl = 1 + inflPeriodo;
      const realPF = montoPF / factorInfl;
      const realUVA = montoUVA / factorInfl;

      let ganadorNominal = "";
      if (montoPF > montoUVA) ganadorNominal = "Plazo Fijo tradicional gana en t√©rminos nominales.";
      else if (montoUVA > montoPF) ganadorNominal = "El Plazo Fijo UVA gana en t√©rminos nominales.";
      else ganadorNominal = "Ambos rinden igual en t√©rminos nominales (seg√∫n supuestos).";

      let ganadorReal = "";
      if (realPF > realUVA) ganadorReal = "Plazo Fijo tradicional gana en t√©rminos reales (descontando inflaci√≥n).";
      else if (realUVA > realPF) ganadorReal = "El Plazo Fijo UVA gana en t√©rminos reales (descontando inflaci√≥n).";
      else ganadorReal = "Ambos rinden igual en t√©rminos reales (seg√∫n supuestos).";

      resultDiv.innerHTML =
        "<strong>Comparaci√≥n PF tradicional vs UVA (" + dias + " d√≠as):</strong>" +
        "<br>PF tradicional: " + formatMoney(montoPF) +
        "<br>PF UVA (estimado): " + formatMoney(montoUVA) +
        "<br><br><strong>Ajustado por inflaci√≥n del per√≠odo (" + (inflPeriodo * 100).toFixed(2) + "%):</strong>" +
        "<br>PF tradicional en t√©rminos reales: " + formatMoney(realPF) +
        "<br>PF UVA en t√©rminos reales: " + formatMoney(realUVA) +
        "<br><br>" +
        "<span style='font-size:0.85rem;color:#9ca3af'>" + ganadorNominal + "<br>" + ganadorReal +
        "<br>Supuesto: inflaci√≥n y TNA constantes durante el per√≠odo.</span>";
    });

    // ---- FV ----
    document.getElementById("btn-fv").addEventListener("click", function () {
      const pv = parseFloat(document.getElementById("fv-pv").value);
      const ratePercent = parseFloat(document.getElementById("fv-rate").value);
      const n = parseFloat(document.getElementById("fv-n").value);
      const period = document.getElementById("fv-period").value;
      const resultDiv = document.getElementById("fv-result");

      if (isNaN(pv) || isNaN(ratePercent) || isNaN(n)) {
        resultDiv.innerHTML = "üëÄ Complet√° todos los campos num√©ricos.";
        return;
      }

      const i = ratePercent / 100;
      const fv = pv * Math.pow(1 + i, n);

      resultDiv.innerHTML =
        "<strong>Valor futuro estimado:</strong>" +
        formatMoney(fv) +
        "<br><span style='font-size:0.85rem;color:#9ca3af'>Asumiendo capitalizaci√≥n " +
        period +
        " y tasa fija del " +
        ratePercent +
        "% durante " +
        n +
        " per√≠odo(s).</span>";
    });

    // ---- PV ----
    document.getElementById("btn-pv").addEventListener("click", function () {
      const fv = parseFloat(document.getElementById("pv-fv").value);
      const ratePercent = parseFloat(document.getElementById("pv-rate").value);
      const n = parseFloat(document.getElementById("pv-n").value);
      const period = document.getElementById("pv-period").value;
      const resultDiv = document.getElementById("pv-result");

      if (isNaN(fv) || isNaN(ratePercent) || isNaN(n)) {
        resultDiv.innerHTML = "üëÄ Complet√° todos los campos num√©ricos.";
        return;
      }

      const i = ratePercent / 100;
      const pvCalc = fv / Math.pow(1 + i, n);

      resultDiv.innerHTML =
        "<strong>Valor presente necesario:</strong>" +
        formatMoney(pvCalc) +
        "<br><span style='font-size:0.85rem;color:#9ca3af'>Asumiendo capitalizaci√≥n " +
        period +
        " y tasa fija del " +
        ratePercent +
        "% durante " +
        n +
        " per√≠odo(s).</span>";
    });

    // ---- PMT ----
    document.getElementById("btn-pmt").addEventListener("click", function () {
      const pv = parseFloat(document.getElementById("pmt-pv").value);
      const ratePercent = parseFloat(document.getElementById("pmt-rate").value);
      const n = parseFloat(document.getElementById("pmt-n").value);
      const period = document.getElementById("pmt-period").value;
      const resultDiv = document.getElementById("pmt-result");

      if (isNaN(pv) || isNaN(ratePercent) || isNaN(n)) {
        resultDiv.innerHTML = "üëÄ Complet√° todos los campos num√©ricos.";
        return;
      }

      const i = ratePercent / 100;

      if (i === 0) {
        const pmt = pv / n;
        resultDiv.innerHTML =
          "<strong>Cuota peri√≥dica (sin inter√©s):</strong>" +
          formatMoney(pmt) +
          "<br><span style='font-size:0.85rem;color:#9ca3af'>Sin inter√©s, simplemente PV / n.</span>";
        return;
      }

      const pmt =
        (pv * i) /
        (1 - Math.pow(1 + i, -n));

      const totalPagos = pmt * n;
      const intereses = totalPagos - pv;

      resultDiv.innerHTML =
        "<strong>Cuota peri√≥dica estimada:</strong>" +
        formatMoney(pmt) +
        "<br><span style='font-size:0.85rem;color:#9ca3af'>Per√≠odo " +
        period +
        ", tasa del " +
        ratePercent +
        "%, " +
        n +
        " per√≠odo(s).</span>" +
        "<br><span style='font-size:0.85rem;color:#9ca3af'>Total abonado: " +
        formatMoney(totalPagos) +
        " &nbsp; | &nbsp; Intereses: " +
        formatMoney(intereses) +
        ".</span>";
    });

    // ---- CONVERSOR DE TASAS ----
    document.getElementById("btn-rate-convert").addEventListener("click", function () {
      const type = document.getElementById("rate-type").value;
      const ratePercent = parseFloat(document.getElementById("rate-input").value);
      const resultDiv = document.getElementById("rate-result");

      if (isNaN(ratePercent)) {
        resultDiv.innerHTML = "üëÄ Ingres√° un valor de tasa.";
        return;
      }

      const r = ratePercent / 100;
      let tem, tea, tna;

      if (type === "tna") {
        tna = r;
        tem = tna / 12;
        tea = Math.pow(1 + tem, 12) - 1;
      } else if (type === "tea") {
        tea = r;
        tem = Math.pow(1 + tea, 1 / 12) - 1;
        tna = tem * 12;
      } else {
        tem = r;
        tea = Math.pow(1 + tem, 12) - 1;
        tna = tem * 12;
      }

      resultDiv.innerHTML =
        "<strong>Conversi√≥n de tasas:</strong>" +
        "<br>TNA ‚âà " +
        formatPercent(tna) +
        "<br>TEA = " +
        formatPercent(tea) +
        "<br>TEM (mensual) = " +
        formatPercent(tem) +
        "<br><span style='font-size:0.8rem;color:#9ca3af'>Supuesto: 12 per√≠odos al a√±o y capitalizaci√≥n mensual.</span>";
    });

    // ---- SIMULADOR DE INVERSI√ìN ----
    document.getElementById("btn-sim").addEventListener("click", function () {
      const pvInput = document.getElementById("sim-pv").value;
      const pv = pvInput === "" ? 0 : parseFloat(pvInput);
      const pmt = parseFloat(document.getElementById("sim-pmt").value);
      const ratePercent = parseFloat(document.getElementById("sim-rate").value);
      const n = parseFloat(document.getElementById("sim-n").value);
      const period = document.getElementById("sim-period").value;
      const resultDiv = document.getElementById("sim-result");

      if (isNaN(pmt) || isNaN(ratePercent) || isNaN(n)) {
        resultDiv.innerHTML = "üëÄ Complet√° al menos aporte, tasa y cantidad de per√≠odos.";
        return;
      }
      if (isNaN(pv)) {
        resultDiv.innerHTML = "üëÄ El capital inicial debe ser un n√∫mero v√°lido o dejarse vac√≠o.";
        return;
      }

      const i = ratePercent / 100;

      let fvInicial = 0;
      if (pv > 0) {
        fvInicial = pv * Math.pow(1 + i, n);
      }

      let fvAportes;
      if (i === 0) {
        fvAportes = pmt * n;
      } else {
        fvAportes = pmt * ((Math.pow(1 + i, n) - 1) / i);
      }

      const fvTotal = fvInicial + fvAportes;
      const totalAportado = pv + pmt * n;

      resultDiv.innerHTML =
        "<strong>Valor futuro estimado:</strong>" +
        formatMoney(fvTotal) +
        "<br><span style='font-size:0.85rem;color:#9ca3af'>Per√≠odo " +
        period +
        ", tasa del " +
        ratePercent +
        "%, " +
        n +
        " per√≠odo(s).</span>" +
        "<br><span style='font-size:0.85rem;color:#9ca3af'>Total aportado: " +
        formatMoney(totalAportado) +
        " (capital inicial + aportes) </span>";
    });

    // ---- CR√âDITOS Y TABLA DE AMORTIZACI√ìN ----
    document.getElementById("btn-loan").addEventListener("click", function () {
      const amount = parseFloat(document.getElementById("loan-amount").value);
      const ratePercent = parseFloat(document.getElementById("loan-rate").value);
      const n = parseFloat(document.getElementById("loan-n").value);
      const system = document.getElementById("loan-system").value;

      const resultDiv = document.getElementById("loan-result");
      const tableWrapper = document.getElementById("loan-table-wrapper");

      if (isNaN(amount) || isNaN(ratePercent) || isNaN(n) || n <= 0) {
        resultDiv.innerHTML = "üëÄ Complet√° monto, tasa y cantidad de per√≠odos.";
        tableWrapper.innerHTML = "";
        return;
      }

      const i = ratePercent / 100;
      let rows = [];
      let saldo = amount;
      let cuota = 0;
      let totalCuotas = 0;
      let totalIntereses = 0;

      if (system === "frances") {
        if (i === 0) {
          cuota = amount / n;
        } else {
          cuota = (amount * i) / (1 - Math.pow(1 + i, -n));
        }

        for (let k = 1; k <= n; k++) {
          const interes = saldo * i;
          const amortizacion = cuota - interes;
          saldo = saldo - amortizacion;

          rows.push({
            periodo: k,
            cuota: cuota,
            interes: interes,
            amortizacion: amortizacion,
            saldo: Math.max(saldo, 0)
          });

          totalCuotas += cuota;
          totalIntereses += interes;
        }

      } else if (system === "aleman") {
        const amortizacionConstante = amount / n;

        for (let k = 1; k <= n; k++) {
          const interes = saldo * i;
          const cuotaPer = amortizacionConstante + interes;
          saldo = saldo - amortizacionConstante;

          rows.push({
            periodo: k,
            cuota: cuotaPer,
            interes: interes,
            amortizacion: amortizacionConstante,
            saldo: Math.max(saldo, 0)
          });

          totalCuotas += cuotaPer;
          totalIntereses += interes;
        }

      } else if (system === "americano") {
        const interesPer = saldo * i;

        for (let k = 1; k <= n; k++) {
          let cuotaPer, interes, amortizacion;

          if (k < n) {
            interes = interesPer;
            amortizacion = 0;
            cuotaPer = interesPer;
          } else {
            interes = interesPer;
            amortizacion = amount;
            cuotaPer = interes + amortizacion;
            saldo = 0;
          }

          rows.push({
            periodo: k,
            cuota: cuotaPer,
            interes: interes,
            amortizacion: amortizacion,
            saldo: Math.max(saldo, 0)
          });

          totalCuotas += cuotaPer;
          totalIntereses += interes;
        }
      }

      if (rows.length === 0) {
        resultDiv.innerHTML = "No se pudo generar la tabla.";
        tableWrapper.innerHTML = "";
        return;
      }

      resultDiv.innerHTML =
        "<strong>Resumen del cr√©dito:</strong>" +
        "<br>Total de cuotas: " + formatMoney(totalCuotas) +
        "<br>Total intereses: " + formatMoney(totalIntereses) +
        "<br><span style='font-size:0.85rem;color:#9ca3af'>Sistema " + system.toUpperCase() +
        " ¬∑ tasa " + ratePercent + "% ¬∑ " + n + " per√≠odo(s).</span>";

      let html = "<table class='amort-table'>";
      html += "<thead><tr>" +
              "<th>#</th>" +
              "<th>Cuota</th>" +
              "<th>Inter√©s</th>" +
              "<th>Amortizaci√≥n</th>" +
              "<th>Saldo</th>" +
              "</tr></thead><tbody>";

      rows.forEach(r => {
        html += "<tr>" +
                "<td>" + r.periodo + "</td>" +
                "<td>" + formatMoney(r.cuota) + "</td>" +
                "<td>" + formatMoney(r.interes) + "</td>" +
                "<td>" + formatMoney(r.amortizacion) + "</td>" +
                "<td>" + formatMoney(r.saldo) + "</td>" +
                "</tr>";
      });

      html += "</tbody><tfoot><tr>" +
              "<td></td>" +
              "<td>" + formatMoney(totalCuotas) + "</td>" +
              "<td>" + formatMoney(totalIntereses) + "</td>" +
              "<td>" + formatMoney(amount) + "</td>" +
              "<td>" + formatMoney(0) + "</td>" +
              "</tr></tfoot></table>";

      tableWrapper.innerHTML = html;
    });
  </script>
</body>
</html>
