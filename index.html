
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora Financiera - Caro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    :root {
      --bg: #0f172a;
      --card: rgba(15, 23, 42, 0.95);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --brand: #a5b4fc;
      --border: rgba(148, 163, 184, 0.25);
      --accent1: #38bdf8;
      --accent2: #8b5cf6;
      --warning: #f97316;
      --success: #22c55e;
      --outline: #4b5563;
      --flash: rgba(250, 204, 21, 0.18);
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      padding: 24px 16px 40px;
    }

    header { margin-bottom: 16px; }
    h1 { text-align: center; margin-bottom: 4px; }

    .subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .brand {
      text-align: center;
      font-size: 0.8rem;
      color: var(--brand);
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-left: 6px;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 16px 18px 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      border: 1px solid var(--border);
    }

    .card h2 { margin-top: 0; margin-bottom: 6px; font-size: 1.05rem; }
    .card small { display: block; margin-bottom: 12px; color: var(--muted); }

    label {
      display: block;
      margin-top: 8px;
      margin-bottom: 4px;
      font-size: 0.85rem;
      color: #d1d5db;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--outline);
      background: #020617;
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
    }

    textarea { min-height: 72px; resize: vertical; }

    input:focus, select:focus, textarea:focus {
      border-color: var(--accent1);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.4);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    button {
      margin-top: 12px;
      width: 100%;
      padding: 9px 10px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      color: white;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }

    button:hover { filter: brightness(1.05); }

    .result {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(15,23,42,0.9);
      border: 1px dashed rgba(148,163,184,0.6);
      font-size: 0.9rem;
      min-height: 44px;
    }

    .result strong {
      display: block;
      font-size: 1rem;
      margin-bottom: 2px;
      color: #facc15;
    }

    .footer-note {
      margin-top: 24px;
      text-align: center;
      font-size: 0.8rem;
      color: var(--muted);
      line-height: 1.4;
    }

    .formula { display: block; margin-top: 4px; }

    /* Tabla amortizaci√≥n */
    .amort-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.8rem;
    }

    .amort-table th, .amort-table td {
      border-bottom: 1px solid #1f2937;
      padding: 4px 6px;
      text-align: right;
    }

    .amort-table th:first-child, .amort-table td:first-child { text-align: center; }
    .amort-table tfoot td { font-weight: 600; border-top: 1px solid #4b5563; }

    /* √çndice ocupa todo el ancho */
    .index-card { grid-column: 1 / -1; }
    .index-card ol { padding-left: 18px; margin: 0; font-size: 0.9rem; }
    .index-card li { margin-bottom: 6px; }

    /* Botones del √≠ndice desplegable */
    .index-item {
      background: none; border: none; color: var(--text);
      padding: 2px 0; text-align: left; font-size: 0.9rem; font-weight: 600;
      cursor: pointer; width: 100%;
    }
    .index-item:hover { color: var(--accent1); }

    .index-detail {
      margin-top: 4px; margin-bottom: 8px;
      padding-left: 8px; font-size: 0.85rem; color: #d1d5db;
    }

    .index-detail span.estado {
      display: inline-block; margin-top: 4px;
      font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;
      padding: 2px 6px; border-radius: 999px; border: 1px solid var(--outline);
    }

    .estado-ok { border-color: var(--success); color: var(--success); }
    .estado-pend { border-color: var(--warning); color: var(--warning); }

    /* Errores de input */
    .input-error {
      border-color: #ef4444 !important;
      box-shadow: 0 0 0 1px rgba(239,68,68,0.4) !important;
    }

    /* Flash highlight al navegar desde el √≠ndice */
    .flash {
      animation: flashBg 1.6s ease-out;
    }
    @keyframes flashBg {
      0% { box-shadow: 0 0 0 0 var(--flash); }
      30% { box-shadow: 0 0 0 8px var(--flash); }
      100% { box-shadow: 0 0 0 0 transparent; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Calculadora Financiera</h1>
      <div class="subtitle">
        Laboratorio de valor del dinero en el tiempo, tasas, cuotas y proyectos
        <span class="tag">beta</span>
      </div>
      <div class="brand">by Carolina Sinead Felipe</div>
    </header>

    <div class="cards">
      <!-- √çNDICE DE M√ìDULOS (DESPLEGABLE) -->
      <section class="card index-card" aria-label="√çndice de m√≥dulos">
        <h2>√çndice de m√≥dulos</h2>
        <small>Hac√© click en cada t√≠tulo para ver y usar la herramienta. üëá</small>

        <ol>
          <li>
            <strong>
              <button class="index-item" aria-expanded="false" aria-controls="panel-inversores" data-panel="panel-inversores">
                Para inversionistas y ahorristas comunes
              </button>
            </strong>
            <div id="panel-inversores" class="index-detail" hidden>
              <ol>
                <li>
                  <button class="index-item go-card" data-target="pf-uva-card">
                    Comparador de Plazo Fijo tradicional vs UVA
                  </button>
                </li>
                <li>
                  <button class="index-item go-card" data-target="simulador-card">
                    Simulador de inter√©s compuesto con aportes variables
                  </button>
                </li>
                <li>
                  <button class="index-item go-card" data-target="objetivos-card">
                    Plan de ahorro para objetivos
                  </button>
                </li>
                <li>
                  <button class="index-item go-card" data-target="tc-card">
                    Calculadora de tipo de cambio
                  </button>
                </li>
              </ol>
            </div>
          </li>

          <li style="margin-top:10px;">
            <strong>Para analistas financieros / corporativos</strong>
            <ol start="5">
              <li>
                <button class="index-item" aria-expanded="false" aria-controls="panel-van-tir" data-panel="panel-van-tir">
                  VAN y TIR (Flujos de caja)
                </button>
                <div id="panel-van-tir" class="index-detail" hidden>
                  Ingresar una serie de flujos.<br />
                  Resultado esperado:<br />
                  ‚Ä¢ Valor Actual Neto (VAN)<br />
                  ‚Ä¢ Tasa Interna de Retorno (TIR)<br />
                  ‚Ä¢ ROI<br />
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
              <li>
                <button class="index-item" aria-expanded="false" aria-controls="panel-duration" data-panel="panel-duration">
                  Duraci√≥n y Duration modificada (bonos)
                </button>
                <div id="panel-duration" class="index-detail" hidden>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
              <li>
                <button class="index-item" aria-expanded="false" aria-controls="panel-curva-bonos" data-panel="panel-curva-bonos">
                  Curva de bonos simple
                </button>
                <div id="panel-curva-bonos" class="index-detail" hidden>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
              <li>
                <button class="index-item" aria-expanded="false" aria-controls="panel-paridad-bonos" data-panel="panel-paridad-bonos">
                  C√°lculo de paridad de bonos
                </button>
                <div id="panel-paridad-bonos" class="index-detail" hidden>
                  <span class="estado estado-pend">Funcionalidad pendiente</span>
                </div>
              </li>
            </ol>
          </li>
        </ol>
      </section>

      <!-- COMPARADOR PF TRADICIONAL VS UVA -->
      <section class="card" id="pf-uva-card">
        <h2>Comparador PF tradicional vs UVA</h2>
        <small>Ingres√° tu escenario y compar√° cu√°l rinde m√°s, en t√©rminos nominales y reales.</small>

        <label for="pf-monto">Monto a invertir</label>
        <input id="pf-monto" type="number" inputmode="decimal" placeholder="Ej: 100000" />

        <label for="pf-tna">TNA Plazo Fijo tradicional (%)</label>
        <input id="pf-tna" type="number" step="0.01" inputmode="decimal" placeholder="Ej: 110" />

        <label for="pf-inflacion">Inflaci√≥n esperada anual (%)</label>
        <input id="pf-inflacion" type="number" step="0.01" inputmode="decimal" placeholder="Ej: 180" />

        <label for="pf-plus">Plus real UVA sobre inflaci√≥n (opcional, % anual)</label>
        <input id="pf-plus" type="number" step="0.01" inputmode="decimal" placeholder="Ej: 0 √≥ 5" />

        <label for="pf-dias">Plazo en d√≠as</label>
        <input id="pf-dias" type="number" inputmode="numeric" placeholder="Ej: 30, 60, 90, 180" />

        <button id="btn-pf-uva">Comparar PF vs UVA</button>

        <div class="result" id="pf-uva-result">
          Ingres√° los datos y te muestro cu√°nto terminar√≠as con PF tradicional vs UVA, y qui√©n gana en t√©rminos reales.
        </div>
      </section>

      <!-- CONVERSOR DE TASAS -->
      <section class="card" id="tasas-card">
        <h2>Conversor de tasas</h2>
        <small>TNA, TEA y TEM suponiendo capitalizaci√≥n mensual (12 per√≠odos al a√±o).</small>

        <label for="rate-type">Tipo de tasa conocida</label>
        <select id="rate-type">
          <option value="tna">TNA (nominal anual)</option>
          <option value="tea">TEA (efectiva anual)</option>
          <option value="tem">TEM (efectiva mensual)</option>
        </select>

        <label for="rate-input">Valor de la tasa (%)</label>
        <input id="rate-input" type="number" step="0.0001" inputmode="decimal" placeholder="Ej: 97 (TNA) √≥ 8 (TEM)" />

        <button id="btn-rate-convert">Convertir</button>

        <div class="result" id="rate-result">
          Ingres√° una tasa y convert√≠ entre TNA, TEA y TEM (mensual).
        </div>
      </section>

      <!-- SIMULADOR DE INVERSI√ìN CON APORTES VARIABLES -->
      <section class="card" id="simulador-card">
        <h2>Simulador inversi√≥n con aportes variables</h2>
        <small>Capital inicial + aportes por per√≠odo con inter√©s compuesto. Pod√©s usar aporte fijo o lista variable.</small>

        <label for="sim-pv">Capital inicial (opcional)</label>
        <input id="sim-pv" type="number" inputmode="decimal" placeholder="Ej: 50000 (pod√©s dejar en blanco)" />

        <label for="sim-pmt">Aporte fijo por per√≠odo (opcional)</label>
        <input id="sim-pmt" type="number" inputmode="decimal" placeholder="Ej: 20000" />

        <label for="sim-aportes">Aportes variables (opcional, separados por comas o l√≠neas)</label>
        <textarea id="sim-aportes" placeholder="Ej: 20000, 0, 15000, 50000"></textarea>

        <label for="sim-rate">Tasa por per√≠odo (%)</label>
        <input id="sim-rate" type="number" step="0.0001" inputmode="decimal" placeholder="Ej: 5 (significa 5%)" />

        <div class="row">
          <div>
            <label for="sim-n">Cantidad de per√≠odos (n)</label>
            <input id="sim-n" type="number" inputmode="numeric" placeholder="Ej: 12 (si cargas lista, se ignora)" />
          </div>
          <div>
            <label for="sim-period">Per√≠odo</label>
            <select id="sim-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-sim">Calcular inversi√≥n</button>

        <div class="result" id="sim-result">
          Carg√° tasa, aportes (fijos o variables) y te muestro el valor futuro y cu√°nto aportaste en total.
        </div>
      </section>

      <!-- PLAN DE AHORRO PARA OBJETIVOS -->
      <section class="card" id="objetivos-card">
        <h2>Plan de ahorro para objetivos</h2>
        <small>Calcul√° el aporte peri√≥dico necesario para alcanzar un objetivo.</small>

        <label for="obj-fv">Objetivo a alcanzar (FV objetivo)</label>
        <input id="obj-fv" type="number" inputmode="decimal" placeholder="Ej: 1000000" />

        <label for="obj-pv">Capital inicial (PV, opcional)</label>
        <input id="obj-pv" type="number" inputmode="decimal" placeholder="Ej: 50000 (pod√©s dejarlo vac√≠o)" />

        <label for="obj-rate">Tasa por per√≠odo (%)</label>
        <input id="obj-rate" type="number" step="0.0001" inputmode="decimal" placeholder="Ej: 4 (significa 4%)" />

        <div class="row">
          <div>
            <label for="obj-n">Cantidad de per√≠odos (n)</label>
            <input id="obj-n" type="number" inputmode="numeric" placeholder="Ej: 36" />
          </div>
          <div>
            <label for="obj-period">Per√≠odo</label>
            <select id="obj-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-obj">Calcular aporte necesario</button>

        <div class="result" id="obj-result">
          Ingres√° objetivo, tasa y per√≠odos para calcular el aporte por per√≠odo requerido.
        </div>
      </section>

      <!-- CALCULADORA DE TIPO DE CAMBIO -->
      <section class="card" id="tc-card">
        <h2>Calculadora de tipo de cambio</h2>
        <small>Convert√≠ entre ARS y USD seg√∫n el tipo de cambio elegido (ingres√° vos la cotizaci√≥n).</small>

        <label for="tc-monto">Monto</label>
        <input id="tc-monto" type="number" inputmode="decimal" placeholder="Ej: 100000" />

        <div class="row">
          <div>
            <label for="tc-direccion">Direcci√≥n</label>
            <select id="tc-direccion">
              <option value="ars-usd">ARS ‚Üí USD</option>
              <option value="usd-ars">USD ‚Üí ARS</option>
            </select>
          </div>
          <div>
            <label for="tc-tipo">Tipo de cambio</label>
            <select id="tc-tipo">
              <option value="oficial">Oficial</option>
              <option value="mep">MEP</option>
              <option value="ccl">CCL</option>
              <option value="solidario">Solidario</option>
              <option value="tarjeta">Tarjeta</option>
              <option value="custom">Personalizado</option>
            </select>
          </div>
        </div>

        <label for="tc-cotizacion">Cotizaci√≥n seleccionada (ARS por USD)</label>
        <input id="tc-cotizacion" type="number" step="0.0001" inputmode="decimal" placeholder="Ej: 1200" />

        <button id="btn-tc">Convertir</button>

        <div class="result" id="tc-result">
          Ingres√° el monto, eleg√≠ direcci√≥n y tipo de cambio, y coloc√° la cotizaci√≥n.
        </div>
      </section>

      <!-- VALOR FUTURO (FV) -->
      <section class="card" id="fv-card">
        <h2>Valor Futuro (FV)</h2>
        <small>¬øCu√°nto voy a tener al final si invierto hoy un monto a una tasa fija?</small>

        <label for="fv-pv">Monto inicial (PV)</label>
        <input id="fv-pv" type="number" inputmode="decimal" placeholder="Ej: 100000" />

        <label for="fv-rate">Tasa por per√≠odo (%)</label>
        <input id="fv-rate" type="number" step="0.0001" inputmode="decimal" placeholder="Ej: 5 (significa 5%)" />

        <div class="row">
          <div>
            <label for="fv-n">Cantidad de per√≠odos (n)</label>
            <input id="fv-n" type="number" inputmode="numeric" placeholder="Ej: 12" />
          </div>
          <div>
            <label for="fv-period">Per√≠odo</label>
            <select id="fv-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-fv">Calcular FV</button>

        <div class="result" id="fv-result">
          Ingres√° los datos y calcul√° el valor futuro.
        </div>
      </section>

      <!-- VALOR PRESENTE (PV) -->
      <section class="card" id="pv-card">
        <h2>Valor Presente (PV)</h2>
        <small>¬øCu√°nto necesito hoy para alcanzar un monto futuro deseado?</small>

        <label for="pv-fv">Monto futuro (FV)</label>
        <input id="pv-fv" type="number" inputmode="decimal" placeholder="Ej: 500000" />

        <label for="pv-rate">Tasa por per√≠odo (%)</label>
        <input id="pv-rate" type="number" step="0.0001" inputmode="decimal" placeholder="Ej: 4 (significa 4%)" />

        <div class="row">
          <div>
            <label for="pv-n">Cantidad de per√≠odos (n)</label>
            <input id="pv-n" type="number" inputmode="numeric" placeholder="Ej: 24" />
          </div>
          <div>
            <label for="pv-period">Per√≠odo</label>
            <select id="pv-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-pv">Calcular PV</button>

        <div class="result" id="pv-result">
          Ingres√° los datos y calcul√° el valor presente.
        </div>
      </section>

      <!-- CUOTA PMT -->
      <section class="card" id="pmt-card">
        <h2>Cuota (PMT)</h2>
        <small>Pr√©stamo o inversi√≥n con pagos iguales (sistema franc√©s cl√°sico).</small>

        <label for="pmt-pv">Monto del pr√©stamo / inversi√≥n (PV)</label>
        <input id="pmt-pv" type="number" inputmode="decimal" placeholder="Ej: 300000" />

        <label for="pmt-rate">Tasa por per√≠odo (%)</label>
        <input id="pmt-rate" type="number" step="0.0001" inputmode="decimal" placeholder="Ej: 6 (significa 6%)" />

        <div class="row">
          <div>
            <label for="pmt-n">Cantidad de per√≠odos (n)</label>
            <input id="pmt-n" type="number" inputmode="numeric" placeholder="Ej: 36" />
          </div>
          <div>
            <label for="pmt-period">Per√≠odo</label>
            <select id="pmt-period">
              <option value="mensual">Mensual</option>
              <option value="anual">Anual</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <button id="btn-pmt">Calcular cuota</button>

        <div class="result" id="pmt-result">
          Ingres√° los datos y calcul√° la cuota peri√≥dica.
        </div>
      </section>

      <!-- CR√âDITOS Y TABLA DE AMORTIZACI√ìN -->
      <section class="card" id="loan-card">
        <h2>Cr√©ditos y tabla de amortizaci√≥n</h2>
        <small>Gener√° el cuadro de cuotas seg√∫n sistema Franc√©s, Alem√°n o Americano.</small>

        <label for="loan-amount">Monto del cr√©dito</label>
        <input id="loan-amount" type="number" inputmode="decimal" placeholder="Ej: 500000" />

        <label for="loan-rate">Tasa por per√≠odo (%)</label>
        <input id="loan-rate" type="number" step="0.0001" inputmode="decimal" placeholder="Ej: 5 (significa 5%)" />

        <div class="row">
          <div>
            <label for="loan-n">Cantidad de per√≠odos (n)</label>
            <input id="loan-n" type="number" inputmode="numeric" placeholder="Ej: 24" />
          </div>
          <div>
            <label for="loan-system">Sistema</label>
            <select id="loan-system">
              <option value="frances">Franc√©s (cuota fija)</option>
              <option value="aleman">Alem√°n (amortizaci√≥n fija)</option>
              <option value="americano">Americano (intereses + bullet)</option>
            </select>
          </div>
        </div>

        <button id="btn-loan">Generar tabla</button>

        <div class="result" id="loan-result">Complet√° los datos y gener√° la tabla de amortizaci√≥n.</div>
        <div id="loan-table-wrapper" aria-live="polite"></div>
      </section>
    </div>

    <div class="footer-note">
      <span class="formula">FV = PV ¬∑ (1 + i)<sup>n</sup></span>
      <span class="formula">PV = FV / (1 + i)<sup>n</sup></span>
      <span class="formula">PMT = PV ¬∑ [ i / (1 - (1 + i)<sup>-n</sup> ) ]</span>
      <span class="formula">TEA = (1 + TEM)<sup>12</sup> ‚àí 1 &nbsp; | &nbsp; TNA ‚âà TEM ¬∑ 12</span>
    </div>
  </div>

  <!-- JS: m√≥dulos (namespaces) en un solo archivo -->
  <script type="module">
    /* ========== Utilidades (Util) ========== */
    const Util = (() => {
      const $ = (idOrSelector) => {
        if (idOrSelector.startsWith("#")) return document.querySelector(idOrSelector);
        return document.getElementById(idOrSelector);
      };

      function formatMoneyARS(value) {
        if (isNaN(value)) return "-";
        return value.toLocaleString("es-AR", { style: "currency", currency: "ARS", maximumFractionDigits: 2 });
      }
      function formatMoneyUSD(value) {
        if (isNaN(value)) return "-";
        return value.toLocaleString("es-AR", { style: "currency", currency: "USD", maximumFractionDigits: 2 });
      }
      function formatMoney(value) { return formatMoneyARS(value); }

      function formatPercent(value) {
        if (isNaN(value)) return "-";
        return (value * 100).toFixed(2) + "%";
      }

      function getNumber(id, allowEmpty = false) {
        const el = $(id);
        if (!el) return NaN;
        const raw = el.value;
        if (allowEmpty && raw === "") return NaN;
        const num = parseFloat(raw);
        return num;
      }

      function markError(id) {
        const el = $(id);
        if (!el) return;
        el.classList.add("input-error");
        setTimeout(() => el.classList.remove("input-error"), 1500);
      }

      function setResult(node, html) {
        if (!node) return;
        node.innerHTML = html;
      }

      function scrollToCard(cardId) {
        const el = document.getElementById(cardId);
        if (!el) return;
        el.scrollIntoView({ behavior: "smooth", block: "start" });
        el.classList.add("flash");
        setTimeout(() => el.classList.remove("flash"), 1600);
      }

      return { $, formatMoney, formatPercent, formatMoneyARS, formatMoneyUSD, getNumber, markError, setResult, scrollToCard };
    })();

    /* ========== F√≥rmulas financieras (Finance) ========== */
    const Finance = (() => {
      const fv = (pv, i, n) => pv * Math.pow(1 + i, n);
      const pv = (fvVal, i, n) => fvVal / Math.pow(1 + i, n);
      const pmt = (pvVal, i, n) => (i === 0 ? pvVal / n : (pvVal * i) / (1 - Math.pow(1 + i, -n)));

      // FV de aportes variables: suma pmt_t ¬∑ (1+i)^(n - t) para t=1..n (pagos al final del per√≠odo)
      const fvAportesVariables = (aportes, i) => {
        const n = aportes.length;
        let total = 0;
        for (let t = 1; t <= n; t++) {
          const pmt_t = aportes[t - 1] || 0;
          total += pmt_t * Math.pow(1 + i, n - t);
        }
        return total;
      };

      return { fv, pv, pmt, fvAportesVariables };
    })();

    /* ========== PF tradicional vs UVA (PFUVA) ========== */
    const PFUVA = (() => {
      function comparar({ monto, tnaPF, inflacion, plus, dias }) {
        const tnaPFDecimal = tnaPF / 100;
        const inflAnualDec = inflacion / 100;
        const plusRealDec = plus / 100;

        const interesPF = tnaPFDecimal * (dias / 365);
        const montoPF = monto * (1 + interesPF);

        const inflPeriodo = Math.pow(1 + inflAnualDec, dias / 365) - 1;

        const tasaUVAAnual = (1 + inflAnualDec) * (1 + plusRealDec) - 1;
        const tasaUVAPeriodo = Math.pow(1 + tasaUVAAnual, dias / 365) - 1;
        const montoUVA = monto * (1 + tasaUVAPeriodo);

        const factorInfl = 1 + inflPeriodo;
        const realPF = montoPF / factorInfl;
        const realUVA = montoUVA / factorInfl;

        return { montoPF, montoUVA, inflPeriodo, realPF, realUVA };
      }

      function render(out, resultDiv, dias) {
        const { formatMoney } = Util;
        const { montoPF, montoUVA, inflPeriodo, realPF, realUVA } = out;

        let ganadorNominal = "";
        if (montoPF > montoUVA) ganadorNominal = "Plazo Fijo tradicional gana en t√©rminos nominales.";
        else if (montoUVA > montoPF) ganadorNominal = "El Plazo Fijo UVA gana en t√©rminos nominales.";
        else ganadorNominal = "Ambos rinden igual en t√©rminos nominales (seg√∫n supuestos).";

        let ganadorReal = "";
        if (realPF > realUVA) ganadorReal = "Plazo Fijo tradicional gana en t√©rminos reales (descontando inflaci√≥n).";
        else if (realUVA > realPF) ganadorReal = "El Plazo Fijo UVA gana en t√©rminos reales (descontando inflaci√≥n).";
        else ganadorReal = "Ambos rinden igual en t√©rminos reales (seg√∫n supuestos).";

        resultDiv.innerHTML =
          `<strong>Comparaci√≥n PF tradicional vs UVA (${dias} d√≠as):</strong>
           <br>PF tradicional: ${formatMoney(montoPF)}
           <br>PF UVA (estimado): ${formatMoney(montoUVA)}
           <br><br><strong>Ajustado por inflaci√≥n del per√≠odo (${(inflPeriodo * 100).toFixed(2)}%):</strong>
           <br>PF tradicional en t√©rminos reales: ${formatMoney(realPF)}
           <br>PF UVA en t√©rminos reales: ${formatMoney(realUVA)}
           <br><br>
           <span style='font-size:0.85rem;color:#9ca3af'>${ganadorNominal}<br>${ganadorReal}
           <br>Supuesto: inflaci√≥n y TNA constantes durante el per√≠odo.</span>`;
      }

      return { comparar, render };
    })();

    /* ========== Conversor de tasas (Tasas) ========== */
    const Tasas = (() => {
      function convertir(type, ratePercent) {
        const r = ratePercent / 100;
        let tem, tea, tna;

        if (type === "tna") {
          tna = r;
          tem = tna / 12;
          tea = Math.pow(1 + tem, 12) - 1;
        } else if (type === "tea") {
          tea = r;
          tem = Math.pow(1 + tea, 1 / 12) - 1;
          tna = tem * 12;
        } else {
          tem = r;
          tea = Math.pow(1 + tem, 12) - 1;
          tna = tem * 12;
        }
        return { tem, tea, tna };
      }
      return { convertir };
    })();

    /* ========== Simulador con aportes variables (Simulador) ========== */
    const Simulador = (() => {
      function parseAportes(raw) {
        if (!raw || !raw.trim()) return [];
        return raw
          .split(/[\n,;]+/g)
          .map(s => parseFloat(s.trim()))
          .filter(v => !isNaN(v));
      }

      function calcular({ pvInicial, aporteFijo, aportesVars, ratePercent, n }) {
        const i = ratePercent / 100;

        // Si hay aportes variables, usamos su longitud como n
        let lista = parseAportes(aportesVars);
        let nFinal = n;
        if (lista.length > 0) {
          nFinal = lista.length;
        } else {
          // si no hay lista, usamos aporte fijo y n
          lista = Array.from({ length: nFinal }, () => aporteFijo || 0);
        }

        const fvInicial = pvInicial > 0 ? Finance.fv(pvInicial, i, nFinal) : 0;
        const fvAportes = i === 0
          ? lista.reduce((acc, v) => acc + v, 0)
          : Finance.fvAportesVariables(lista, i);

        const fvTotal = fvInicial + fvAportes;
        const totalAportado = (pvInicial || 0) + lista.reduce((acc, v) => acc + v, 0);

        return { fvTotal, totalAportado, nFinal, i, us√≥Variables: parseAportes(aportesVars).length > 0 };
      }

      function render(out, node, period, ratePercent) {
        const { formatMoney } = Util;
        const { fvTotal, totalAportado, nFinal, us√≥Variables } = out;

        node.innerHTML =
          `<strong>Valor futuro estimado:</strong>${formatMoney(fvTotal)}
           <br><span style='font-size:0.85rem;color:#9ca3af'>
           Per√≠odo ${period}, tasa del ${ratePercent}%, ${nFinal} per√≠odo(s). ${us√≥Variables ? "Aportes variables" : "Aporte fijo"}.
           </span>
           <br><span style='font-size:0.85rem;color:#9ca3af'>Total aportado: ${formatMoney(totalAportado)} (capital inicial + aportes)</span>`;
      }

      return { calcular };
    })();

    /* ========== Plan de ahorro para objetivos (Objetivos) ========== */
    const Objetivos = (() => {
      // Aporte necesario para alcanzar FV dado PV, i, n
      // FV = PV*(1+i)^n + PMT * [((1+i)^n - 1) / i]  => PMT = (FV - PV*(1+i)^n) * i / ((1+i)^n - 1)
      function calcularPMTObjetivo({ fvObj, pvInicial, ratePercent, n }) {
        const i = ratePercent / 100;
        if (n <= 0) return { pmtNecesario: NaN, i, n };

        const fvInicial = pvInicial > 0 ? Finance.fv(pvInicial, i, n) : 0;
        if (i === 0) {
          const resto = fvObj - fvInicial;
          const pmtNecesario = resto / n;
          return { pmtNecesario, i, n };
        }
        const numerador = (fvObj - fvInicial) * i;
        const denominador = Math.pow(1 + i, n) - 1;
        const pmtNecesario = numerador / denominador;
        return { pmtNecesario, i, n };
      }

      function render({ pmtNecesario }, node, period, ratePercent, n) {
        node.innerHTML =
          `<strong>Aporte por per√≠odo necesario:</strong>${Util.formatMoney(pmtNecesario)}
           <br><span style='font-size:0.85rem;color:#9ca3af'>
           Para alcanzar el objetivo en ${n} per√≠odo(s), con capitalizaci√≥n ${period} y tasa del ${ratePercent}%.
           </span>`;
      }

      return { calcularPMTObjetivo, render };
    })();

    /* ========== Calculadora de tipo de cambio (TipoCambio) ========== */
    const TipoCambio = (() => {
      function convertir({ monto, direccion, cotizacion }) {
        if (direccion === "ars-usd") {
          const usd = cotizacion > 0 ? (monto / cotizacion) : NaN;
          return { origen: "ARS", destino: "USD", result: usd };
        } else {
          const ars = cotizacion > 0 ? (monto * cotizacion) : NaN;
          return { origen: "USD", destino: "ARS", result: ars };
        }
      }

      function render(out, node) {
        const { origen, destino, result } = out;
        const fmt = destino === "USD" ? Util.formatMoneyUSD : Util.formatMoneyARS;
        node.innerHTML =
          `<strong>Conversi√≥n ${origen} ‚Üí ${destino}:</strong>${fmt(result)}
           <br><span style='font-size:0.85rem;color:#9ca3af'>Resultado estimado seg√∫n tu cotizaci√≥n ingresada.</span>`;
      }

      return { convertir, render };
    })();

    /* ========== Valor Futuro (FV) ========== */
    const FV = (() => {
      function calcular(pvVal, ratePercent, n) {
        const i = ratePercent / 100;
        const fv = Finance.fv(pvVal, i, n);
        return { fv };
      }

      function render({ fv }, node, period, ratePercent, n) {
        node.innerHTML =
          `<strong>Valor futuro estimado:</strong>${Util.formatMoney(fv)}
           <br><span style='font-size:0.85rem;color:#9ca3af'>Asumiendo capitalizaci√≥n ${period} y tasa fija del ${ratePercent}% durante ${n} per√≠odo(s).</span>`;
      }

      return { calcular, render };
    })();

    /* ========== Valor Presente (PV) ========== */
    const PV = (() => {
      function calcular(fvVal, ratePercent, n) {
        const i = ratePercent / 100;
        const pvCalc = Finance.pv(fvVal, i, n);
        return { pvCalc };
      }

      function render({ pvCalc }, node, period, ratePercent, n) {
        node.innerHTML =
          `<strong>Valor presente necesario:</strong>${Util.formatMoney(pvCalc)}
           <br><span style='font-size:0.85rem;color:#9ca3af'>Asumiendo capitalizaci√≥n ${period} y tasa fija del ${ratePercent}% durante ${n} per√≠odo(s).</span>`;
      }

      return { calcular, render };
    })();

    /* ========== Cuota PMT (PMT) ========== */
    const PMT = (() => {
      function calcular(pvVal, ratePercent, n) {
        const i = ratePercent / 100;
        if (i === 0) {
          const pmt = pvVal / n;
          const totalPagos = pmt * n;
          const intereses = totalPagos - pvVal;
          return { pmt, totalPagos, intereses, sinInteres: true };
        }
        const pmt = Finance.pmt(pvVal, i, n);
        const totalPagos = pmt * n;
        const intereses = totalPagos - pvVal;
        return { pmt, totalPagos, intereses, sinInteres: false };
      }

      function render(out, node, period, ratePercent, n) {
        const { pmt, totalPagos, intereses, sinInteres } = out;
        if (sinInteres) {
          node.innerHTML =
            `<strong>Cuota peri√≥dica (sin inter√©s):</strong>${Util.formatMoney(pmt)}
             <br><span style='font-size:0.85rem;color:#9ca3af'>Sin inter√©s, simplemente PV / n.</span>`;
          return;
        }

        node.innerHTML =
          `<strong>Cuota peri√≥dica estimada:</strong>${Util.formatMoney(pmt)}
           <br><span style='font-size:0.85rem;color:#9ca3af'>Per√≠odo ${period}, tasa del ${ratePercent}%, ${n} per√≠odo(s).</span>
           <br><span style='font-size:0.85rem;color:#9ca3af'>Total abonado: ${Util.formatMoney(totalPagos)} &nbsp; | &nbsp; Intereses: ${Util.formatMoney(intereses)}.</span>`;
      }

      return { calcular, render };
    })();

    /* ========== Amortizaci√≥n de cr√©ditos (Amortizacion) ========== */
    const Amortizacion = (() => {
      function generar(amount, ratePercent, n, system) {
        const i = ratePercent / 100;
        let rows = [];
        let saldo = amount;
        let cuota = 0;
        let totalCuotas = 0;
        let totalIntereses = 0;

        if (system === "frances") {
          cuota = i === 0 ? amount / n : Finance.pmt(amount, i, n);

          for (let k = 1; k <= n; k++) {
            const interes = saldo * i;
            const amortizacion = cuota - interes;
            saldo = saldo - amortizacion;

            rows.push({ periodo: k, cuota, interes, amortizacion, saldo: Math.max(saldo, 0) });
            totalCuotas += cuota;
            totalIntereses += interes;
          }
        } else if (system === "aleman") {
          const amortizacionConstante = amount / n;

          for (let k = 1; k <= n; k++) {
            const interes = saldo * i;
            const cuotaPer = amortizacionConstante + interes;
            saldo = saldo - amortizacionConstante;

            rows.push({ periodo: k, cuota: cuotaPer, interes, amortizacion: amortizacionConstante, saldo: Math.max(saldo, 0) });
            totalCuotas += cuotaPer;
            totalIntereses += interes;
          }
        } else if (system === "americano") {
          const interesPer = amount * i;

          for (let k = 1; k <= n; k++) {
            let cuotaPer, interes, amortizacion;

            if (k < n) {
              interes = interesPer;
              amortizacion = 0;
              cuotaPer = interesPer;
            } else {
              interes = interesPer;
              amortizacion = amount;
              cuotaPer = interes + amortizacion;
              saldo = 0;
            }

            rows.push({ periodo: k, cuota: cuotaPer, interes, amortizacion, saldo: Math.max(saldo, 0) });
            totalCuotas += cuotaPer;
            totalIntereses += interes;
          }
        }

        const resumen = { totalCuotas, totalIntereses, amount };
        return { rows, resumen };
      }

      function render(rows, resumen, resultDiv, tableWrapper, ratePercent, n, system) {
        if (!rows.length) {
          resultDiv.innerHTML = "No se pudo generar la tabla.";
          tableWrapper.innerHTML = "";
          return;
        }

        resultDiv.innerHTML =
          `<strong>Resumen del cr√©dito:</strong>
           <br>Total de cuotas: ${Util.formatMoney(resumen.totalCuotas)}
           <br>Total intereses: ${Util.formatMoney(resumen.totalIntereses)}
           <br><span style='font-size:0.85rem;color:#9ca3af'>Sistema ${system.toUpperCase()} ¬∑ tasa ${ratePercent}% ¬∑ ${n} per√≠odo(s).</span>`;

        let html = `<table class="amort-table">
            <thead><tr>
              <th>#</th><th>Cuota</th><th>Inter√©s</th><th>Amortizaci√≥n</th><th>Saldo</th>
            </tr></thead><tbody>`;

        rows.forEach(r => {
          html += `<tr>
            <td>${r.periodo}</td>
            <td>${Util.formatMoney(resumen.totalCuotas ? r.cuota : 0)}</td>
            <td>${Util.formatMoney(r.interes)}</td>
            <td>${Util.formatMoney(r.amortizacion)}</td>
            <td>${Util.formatMoney(r.saldo)}</td>
          </tr>`;
        });

        html += `</tbody><tfoot><tr>
          <td></td>
          <td>${Util.formatMoney(resumen.totalCuotas)}</td>
          <td>${Util.formatMoney(resumen.totalIntereses)}</td>
          <td>${Util.formatMoney(resumen.amount)}</td>
          <td>${Util.formatMoney(0)}</td>
        </tr></tfoot></table>`;

        tableWrapper.innerHTML = html;
      }

      return { generar, render };
    })();

    /* ========== Orquestaci√≥n de eventos (App) ========== */
    const App = (() => {
      const { $, getNumber, markError, setResult, formatPercent, scrollToCard } = Util;

      // √çndice desplegable accesible
      document.querySelectorAll(".index-item[data-panel]").forEach(btn => {
        btn.addEventListener("click", () => {
          const panelId = btn.dataset.panel;
          const panel = document.getElementById(panelId);
          if (!panel) return;
          const abrir = panel.hasAttribute("hidden");
          panel.toggleAttribute("hidden", !abrir);
          btn.setAttribute("aria-expanded", String(abrir));
        });
      });

      // Navegaci√≥n: al tocar un item del √≠ndice, ir al card y resaltar
      document.querySelectorAll(".index-item.go-card").forEach(btn => {
        btn.addEventListener("click", () => {
          const target = btn.dataset.target;
          if (target) scrollToCard(target);
        });
      });

      // PF vs UVA
      $("#btn-pf-uva")?.addEventListener("click", () => {
        const monto = getNumber("pf-monto");
        const tnaPF = getNumber("pf-tna");
        const inflacion = getNumber("pf-inflacion");
        const plus = getNumber("pf-plus", true) || 0;
        const dias = getNumber("pf-dias");
        const resultDiv = $("#pf-uva-result");

        const invalid = [];
        if (isNaN(monto)) invalid.push("pf-monto");
        if (isNaN(tnaPF)) invalid.push("pf-tna");
        if (isNaN(inflacion)) invalid.push("pf-inflacion");
        if (isNaN(dias) || dias <= 0) invalid.push("pf-dias");
        if (invalid.length) {
          invalid.forEach(markError);
          return setResult(resultDiv, "üëÄ Complet√° monto, TNA, inflaci√≥n y d√≠as (el plus UVA puede quedar vac√≠o).");
        }

        const out = PFUVA.comparar({ monto, tnaPF, inflacion, plus, dias });
        PFUVA.render(out, resultDiv, dias);
      });

      // Conversor de tasas
      $("#btn-rate-convert")?.addEventListener("click", () => {
        const type = $("#rate-type").value;
        const ratePercent = getNumber("rate-input");
        const resultDiv = $("#rate-result");

        if (isNaN(ratePercent)) {
          markError("rate-input");
          return setResult(resultDiv, "üëÄ Ingres√° un valor de tasa.");
        }

        const conv = Tasas.convertir(type, ratePercent);
        setResult(resultDiv,
          `<strong>Conversi√≥n de tasas:</strong>
           <br>TNA ‚âà ${formatPercent(conv.tna)}
           <br>TEA = ${formatPercent(conv.tea)}
           <br>TEM (mensual) = ${formatPercent(conv.tem)}
           <br><span style='font-size:0.8rem;color:#9ca3af'>Supuesto: 12 per√≠odos al a√±o y capitalizaci√≥n mensual.</span>`
        );
      });

      // Simulador (aportes variables)
      $("#btn-sim")?.addEventListener("click", () => {
        const pvInicial = getNumber("sim-pv");
        const aporteFijo = getNumber("sim-pmt", true) || 0;
        const ratePercent = getNumber("sim-rate");
        const n = getNumber("sim-n", true) || 0;
        const period = $("#sim-period").value;
        const aportesVars = $("#sim-aportes").value;
        const resultDiv = $("#sim-result");

        if (isNaN(ratePercent)) {
          markError("sim-rate");
          return setResult(resultDiv, "üëÄ Complet√° la tasa por per√≠odo.");
        }
        if (!aportesVars.trim() && (isNaN(aporteFijo) || isNaN(n) || n <= 0)) {
          markError("sim-pmt"); markError("sim-n");
          return setResult(resultDiv, "üëÄ Carg√° aporte fijo y cantidad de per√≠odos, o una lista de aportes variables.");
        }
        if (isNaN(pvInicial)) {
          markError("sim-pv");
          return setResult(resultDiv, "üëÄ El capital inicial debe ser un n√∫mero v√°lido o dejarse vac√≠o.");
        }

        const out = Simulador.calcular({ pvInicial: pvInicial || 0, aporteFijo, aportesVars, ratePercent, n });
        Simulador.render(out, resultDiv, period, ratePercent);
      });

      // Objetivos (aporte necesario)
      $("#btn-obj")?.addEventListener("click", () => {
        const fvObj = getNumber("obj-fv");
        const pvInicial = getNumber("obj-pv", true) || 0;
        const ratePercent = getNumber("obj-rate");
        const n = getNumber("obj-n");
        const period = $("#obj-period").value;
        const resultDiv = $("#obj-result");

        const invalid = [];
        if (isNaN(fvObj)) invalid.push("obj-fv");
        if (isNaN(ratePercent)) invalid.push("obj-rate");
        if (isNaN(n) || n <= 0) invalid.push("obj-n");

        if (invalid.length) {
          invalid.forEach(markError);
          return setResult(resultDiv, "üëÄ Complet√° objetivo (FV), tasa y cantidad de per√≠odos.");
        }

        const out = Objetivos.calcularPMTObjetivo({ fvObj, pvInicial, ratePercent, n });
        Objetivos.render(out, resultDiv, period, ratePercent, n);
      });

      // Tipo de cambio
      $("#btn-tc")?.addEventListener("click", () => {
        const monto = getNumber("tc-monto");
        const direccion = $("#tc-direccion").value;
        const tipo = $("#tc-tipo").value;
        const cotizacion = getNumber("tc-cotizacion");
        const resultDiv = $("#tc-result");

        if (isNaN(monto)) { markError("tc-monto"); return setResult(resultDiv, "üëÄ Ingres√° un monto."); }
        if (isNaN(cotizacion) || cotizacion <= 0) { markError("tc-cotizacion"); return setResult(resultDiv, "üëÄ Ingres√° una cotizaci√≥n v√°lida (ARS por USD)."); }

        // Nota: 'tipo' est√° para sem√°ntica (eleg√≠s cu√°l est√°s usando), la cotizaci√≥n la ingres√°s vos.
        const out = TipoCambio.convertir({ monto, direccion, cotizacion });
        TipoCambio.render(out, resultDiv);
      });

      // FV
      $("#btn-fv")?.addEventListener("click", () => {
        const pvVal = getNumber("fv-pv");
        const ratePercent = getNumber("fv-rate");
        const n = getNumber("fv-n");
        const period = $("#fv-period").value;
        const resultDiv = $("#fv-result");

        if ([pvVal, ratePercent, n].some(x => isNaN(x))) {
          ["fv-pv", "fv-rate", "fv-n"].forEach(markError);
          return setResult(resultDiv, "üëÄ Complet√° todos los campos num√©ricos.");
        }

        const out = FV.calcular(pvVal, ratePercent, n);
        FV.render(out, resultDiv, period, ratePercent, n);
      });

      // PV
      $("#btn-pv")?.addEventListener("click", () => {
        const fvVal = getNumber("pv-fv");
        const ratePercent = getNumber("pv-rate");
        const n = getNumber("pv-n");
        const period = $("#pv-period").value;
        const resultDiv = $("#pv-result");

        if ([fvVal, ratePercent, n].some(x => isNaN(x))) {
          ["pv-fv", "pv-rate", "pv-n"].forEach(markError);
          return setResult(resultDiv, "üëÄ Complet√° todos los campos num√©ricos.");
        }

        const out = PV.calcular(fvVal, ratePercent, n);
        PV.render(out, resultDiv, period, ratePercent, n);
      });

      // PMT
      $("#btn-pmt")?.addEventListener("click", () => {
        const pvVal = getNumber("pmt-pv");
        const ratePercent = getNumber("pmt-rate");
        const n = getNumber("pmt-n");
        const period = $("#pmt-period").value;
        const resultDiv = $("#pmt-result");

        if ([pvVal, ratePercent, n].some(x => isNaN(x))) {
          ["pmt-pv", "pmt-rate", "pmt-n"].forEach(markError);
          return setResult(resultDiv, "üëÄ Complet√° todos los campos num√©ricos.");
        }

        const out = PMT.calcular(pvVal, ratePercent, n);
        PMT.render(out, resultDiv, period, ratePercent, n);
      });

      // Amortizaci√≥n
      $("#btn-loan")?.addEventListener("click", () => {
        const amount = getNumber("loan-amount");
        const ratePercent = getNumber("loan-rate");
        const n = getNumber("loan-n");
        const system = $("#loan-system").value;

        const resultDiv = $("#loan-result");
        const wrapper = $("#loan-table-wrapper");

        if (isNaN(amount) || isNaN(ratePercent) || isNaN(n) || n <= 0) {
          ["loan-amount", "loan-rate", "loan-n"].forEach(markError);
          wrapper.innerHTML = "";
          return setResult(resultDiv, "üëÄ Complet√° monto, tasa y cantidad de per√≠odos.");
        }

        const { rows, resumen } = Amortizacion.generar(amount, ratePercent, n, system);
        Amortizacion.render(rows, resumen, resultDiv, wrapper, ratePercent, n, system);
      });
    })();
  </script>
</body>
</html>

